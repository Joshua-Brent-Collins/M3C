os.loadAPI("M3C/kvApi")
os.loadAPI("M3C/utils")

local dsuInfo = {}
local dsus = utils.findAndWrapAll("deep_storage_unit")

for block, dsu in pairs(dsus) do
  local items = dsu.getStoredItems()

  if items ~= nil then
    dsuInfo[items.display_name] = items.qty;
  end
end

for block, qty in pairs(dsuInfo) do
  print(block .. ":")

--while true do
  --sleep(1)
--end


os.loadAPI("M3C/kvApi")
os.loadAPI("M3C/utils")

local dsu = {}

dsu["setDsus"] = function (dsus)
--call from other files
--utils.findAndWrap("deep_storage_unit")
  dsu["dsus"] = dsus
end

dsu["buildData"] = function ()
  dsu["data"] = {}

  for block, dsu in pairs(dsus) do
    local items = dsu.getStoredItems()
    if items ~= nil then
      dsu["data"][items.display_name] = items.qty
    end
  end

  return dsu["data"]
end

dsu["print"] = function ()
  for block, qty in pairs(dsu["data"]) do
    print(block .. ": " .. utils.formatInt(qty))
  end
end
